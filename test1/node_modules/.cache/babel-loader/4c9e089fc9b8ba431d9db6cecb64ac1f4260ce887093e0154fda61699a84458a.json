{"ast":null,"code":"import jwt_prase from '@/assets/js/jwtPrase';\nexport default {\n  name: \"NewTopic\",\n  emits: ['close'],\n  data() {\n    return {\n      newTopicForm: {\n        topicName: '',\n        type: '',\n        source: '',\n        major: '',\n        college: '',\n        createdBy: '',\n        createdTime: '',\n        updatedBy: '',\n        updatedTime: ''\n      },\n      typeList: [],\n      sourceList: [],\n      rules: {\n        \"topicName\": [{\n          required: true,\n          message: '请输入课题名称',\n          trigger: 'blur'\n        }],\n        \"type\": [{\n          required: true,\n          message: '请选择课题类型',\n          trigger: 'change'\n        }],\n        \"source\": [{\n          required: true,\n          message: '请选择课题来源',\n          trigger: 'change'\n        }]\n      }\n    };\n  },\n  methods: {\n    submitForm(formName) {\n      this.$refs[formName].validate(valid => {\n        if (valid) {\n          //验证通过\n          //发送请求，新增topic\n          this.addTopic();\n          this.resetForm(formName);\n          this.closeDialog();\n        } else {\n          return false;\n        }\n      });\n    },\n    nextTopic(formName) {\n      this.$refs[formName].validate(valid => {\n        if (valid) {\n          //验证通过\n\n          this.addTopic();\n          this.resetForm(formName);\n        } else {\n          return false;\n        }\n      });\n    },\n    resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    closeDialog() {\n      this.$emit('close', false);\n    },\n    //发送请求获取typeList\n    async getTypeList() {\n      const resp = await this.$http.get('/dict/topicType');\n      if (resp.data.code === 200) {\n        this.typeList = resp.data.data;\n      }\n    },\n    //发送请求获取sourceList\n    async getSourceList() {\n      const resp = await this.$http.get('/dict/topicSource');\n      if (resp.data.code === 200) {\n        this.sourceList = resp.data.data;\n      }\n    },\n    //newTopic表单的初始化\n    async initTopicForm() {\n      let tId = jwt_prase().id;\n      this.newTopicForm.createdBy = tId;\n      this.newTopicForm.updatedBy = tId;\n      const resp = await this.$http.get(\"/userTutor/\" + tId);\n      if (resp.data.code === 200) {\n        this.newTopicForm.college = resp.data.data.college;\n        this.newTopicForm.major = resp.data.data.major;\n      }\n    },\n    //新增topic\n    async addTopic() {\n      this.newTopicForm.updatedTime = this.newTopicForm.createdTime = new Date().toJSON();\n      console.log(this.newTopicForm);\n      const resp = this.$http({\n        url: \"/topic\",\n        method: \"put\",\n        data: this.newTopicForm\n      });\n      if (resp.data.code === 200 && resp.data.data === true) {\n        //新增成功\n        this.$message({\n          message: \"课题已提交到系统，等待管理员审核。\",\n          type: \"success\"\n        });\n      } else {\n        //失败\n        this.$message({\n          message: resp.data.msg,\n          type: \"error\"\n        });\n      }\n    }\n  },\n  created() {\n    //发送请求获取typeList\n    this.getTypeList();\n    //发送请求获取sourceList\n    this.getSourceList();\n    this.initTopicForm();\n  }\n};","map":{"version":3,"mappings":"AAmCA;AAEA;EACAA;EACAC;EACAC;IAEA;MACAC,cACA;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MAEAC;MACAC;MAEAC;QACA,cACA;UAAAC;UAAAC;UAAAC;QAAA,EACA;QACA,SACA;UAAAF;UAAAC;UAAAC;QAAA,EACA;QACA,WACA;UAAAF;UAAAC;UAAAC;QAAA;MAEA;IAEA;EACA;EACAC;IACAC;MACA;QACA;UAAA;UACA;UACA;UAEA;UACA;QACA;UACA;QACA;MACA;IACA;IACAC;MACA;QACA;UAAA;;UAEA;UAEA;QACA;UACA;QACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;IACA;IACA;MACA;MACA;QACA;MACA;IACA;IACA;IACA;MACA;MACA;QACA;MACA;IACA;IACA;IACA;MAEA;MACA;MACA;MAEA;MACA;QACA;QACA;MACA;IACA;IACA;IACA;MACA;MACAC;MACA;QACAC;QACAC;QACAxB;MACA;MAEA;QACA;QACA;UACAe;UACAZ;QACA;MACA;QACA;QACA;UACAY;UACAZ;QACA;MACA;IAEA;EAEA;EACAsB;IACA;IACA;IACA;IACA;IACA;EAEA;AAGA","names":["name","emits","data","newTopicForm","topicName","type","source","major","college","createdBy","createdTime","updatedBy","updatedTime","typeList","sourceList","rules","required","message","trigger","methods","submitForm","nextTopic","resetForm","closeDialog","console","url","method","created"],"sourceRoot":"src/components/home/tutor","sources":["NewTopic.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <el-row class=\"header_main\">\r\n            <div class=\"title_div\">毕业课题提交表</div>\r\n        </el-row>\r\n        <!-- 新增毕业课题 -->\r\n        <el-form :inline=\"true\" ref=\"newTopicForm\" :rules=\"rules\" :model=\"newTopicForm\" class=\"form_main\">\r\n\r\n            <el-form-item label=\"课题名称\" prop=\"topicName\">\r\n                <el-input v-model=\"newTopicForm.topicName\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"课题类型\" prop=\"type\">\r\n                <el-select v-model=\"newTopicForm.type\">\r\n                    <el-option v-for=\"item in typeList\" :label=\"item.description\" :value=\"item.type\"\r\n                        :key=\"item.type\"></el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"课题来源\" prop=\"source\">\r\n                <el-select v-model=\"newTopicForm.source\">\r\n                    <el-option v-for=\"item in sourceList\" :label=\"item.description\" :value=\"item.source\"\r\n                        :key=\"item.source\"></el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n        </el-form>\r\n        <el-row>\r\n            <el-button plain type=\"primary\" class=\"btn\" @click=\"nextTopic('newTopicForm')\">提交,编辑下一个课题</el-button>\r\n            <el-button plain type=\"danger\" class=\"btn\" @click=\"resetForm('newTopicForm')\">重新输入</el-button>\r\n            <el-button plain type=\"success\" class=\"btn\" @click=\"submitForm('newTopicForm')\">提交,关闭页面</el-button>\r\n        </el-row>\r\n\r\n\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport jwt_prase from '@/assets/js/jwtPrase';\r\n\r\nexport default {\r\n    name: \"NewTopic\",\r\n    emits: ['close'],\r\n    data() {\r\n\r\n        return {\r\n            newTopicForm:\r\n            {\r\n                topicName: '',\r\n                type: '',\r\n                source: '',\r\n                major: '',\r\n                college: '',\r\n                createdBy: '',\r\n                createdTime: '',\r\n                updatedBy: '',\r\n                updatedTime: ''\r\n            },\r\n\r\n            typeList: [],\r\n            sourceList: [],\r\n\r\n            rules: {\r\n                \"topicName\": [\r\n                    { required: true, message: '请输入课题名称', trigger: 'blur' }\r\n                ],\r\n                \"type\": [\r\n                    { required: true, message: '请选择课题类型', trigger: 'change' }\r\n                ],\r\n                \"source\": [\r\n                    { required: true, message: '请选择课题来源', trigger: 'change' }\r\n                ]\r\n            }\r\n\r\n        }\r\n    },\r\n    methods: {\r\n        submitForm(formName) {\r\n            this.$refs[formName].validate((valid) => {\r\n                if (valid) {//验证通过\r\n                    //发送请求，新增topic\r\n                    this.addTopic()\r\n                    \r\n                    this.resetForm(formName)\r\n                    this.closeDialog()\r\n                } else {\r\n                    return false;\r\n                }\r\n            })\r\n        },\r\n        nextTopic(formName) {\r\n            this.$refs[formName].validate((valid) => {\r\n                if (valid) {//验证通过\r\n                    \r\n                    this.addTopic()\r\n\r\n                    this.resetForm(formName)\r\n                } else {\r\n                    return false;\r\n                }\r\n            })\r\n        },\r\n        resetForm(formName) {\r\n            this.$refs[formName].resetFields();\r\n        },\r\n        closeDialog() {\r\n            this.$emit('close', false)\r\n        },\r\n        //发送请求获取typeList\r\n        async getTypeList() {\r\n            const resp = await this.$http.get('/dict/topicType')\r\n            if (resp.data.code === 200) {\r\n                this.typeList = resp.data.data\r\n            }\r\n        },\r\n        //发送请求获取sourceList\r\n        async getSourceList() {\r\n            const resp = await this.$http.get('/dict/topicSource')\r\n            if (resp.data.code === 200) {\r\n                this.sourceList = resp.data.data\r\n            }\r\n        },\r\n        //newTopic表单的初始化\r\n        async initTopicForm() {\r\n\r\n            let tId = jwt_prase().id\r\n            this.newTopicForm.createdBy = tId\r\n            this.newTopicForm.updatedBy = tId\r\n\r\n            const resp = await this.$http.get(\"/userTutor/\" + tId)\r\n            if (resp.data.code === 200) {\r\n                this.newTopicForm.college = resp.data.data.college\r\n                this.newTopicForm.major = resp.data.data.major\r\n            }\r\n        },\r\n        //新增topic\r\n        async addTopic() {\r\n            this.newTopicForm.updatedTime = this.newTopicForm.createdTime = new Date().toJSON()\r\n            console.log(this.newTopicForm);\r\n            const resp = this.$http({\r\n                url: \"/topic\",\r\n                method: \"put\",\r\n                data: this.newTopicForm\r\n            })\r\n\r\n            if (resp.data.code === 200 && resp.data.data === true){\r\n                //新增成功\r\n                this.$message({\r\n                    message:\"课题已提交到系统，等待管理员审核。\",\r\n                    type:\"success\"\r\n                })\r\n            }else{\r\n                //失败\r\n                this.$message({\r\n                    message:resp.data.msg,\r\n                    type:\"error\"\r\n                })\r\n            }\r\n\r\n        }\r\n\r\n    },\r\n    created() {\r\n        //发送请求获取typeList\r\n        this.getTypeList()\r\n        //发送请求获取sourceList\r\n        this.getSourceList()\r\n        this.initTopicForm()\r\n\r\n    }\r\n\r\n\r\n}\r\n</script>\r\n<style scoped lang=\"less\">\r\n.form_main {\r\n    line-height: 23px;\r\n}\r\n\r\n.btn {\r\n    width: 200px;\r\n    font-size: 18px;\r\n}\r\n\r\n.header_main {\r\n    line-height: 23px;\r\n    font-size: 18px;\r\n    text-align: left;\r\n    margin-bottom: 50px;\r\n\r\n}\r\n\r\n.title_div {\r\n    text-align: center;\r\n    font-size: 22px;\r\n    font-weight: bold;\r\n}\r\n\r\n.header_main .el-button {\r\n    height: 23px;\r\n    line-height: 23px;\r\n    font-size: 18px;\r\n    text-align: right;\r\n    padding: 0;\r\n\r\n}\r\n\r\n\r\n.el-select {\r\n    width: 120px;\r\n}\r\n\r\n/deep/.el-form--inline .el-form-item__label {\r\n    font-size: 18px;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}