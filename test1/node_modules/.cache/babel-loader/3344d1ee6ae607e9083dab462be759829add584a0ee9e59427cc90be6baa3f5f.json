{"ast":null,"code":"import jwt_prase from '@/assets/js/jwtPrase';\nimport html2canvas from 'html2canvas';\nimport JsPDF from 'jspdf';\nexport default {\n  name: \"Detail\",\n  data() {\n    return {\n      tName: '',\n      title: '',\n      stuNum: '',\n      topicList: [],\n      passedResult: {\n        unPassed: 0,\n        basePassed: 0,\n        passed: 0\n      },\n      suggestions: ''\n    };\n  },\n  methods: {\n    //导出审核表\n    pdfDownload() {\n      let myBox = this.$refs.checkTable; //获取ref里面的内容\n      html2canvas(myBox, {\n        useCORS: true,\n        //是否尝试使用CORS从服务器加载图像\n        allowTaint: true,\n        dpi: 300,\n        //解决生产图片模糊\n        scale: 3 //清晰度--放大倍数\n      }).then(function (canvas) {\n        let contentWidth = canvas.width;\n        let contentHeight = canvas.height;\n        let pageHeight = contentWidth / 592.28 * 841.89; // 一页pdf显示html页面生成的canvas高度;\n        let leftHeight = contentHeight; //未生成pdf的html页面高度\n        let position = 0; //pdf页面偏移\n        //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高\n        // let imgWidth = 595.28\n        let imgWidth = 560.28; //宽度\n        let imgHeight = 592.28 / contentWidth * contentHeight;\n        let pageData = canvas.toDataURL('image/jpeg', 1.0);\n        let PDF = new JsPDF('', 'pt', 'a4');\n\n        // 有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)\n        //当内容未超过pdf一页显示的范围，无需分页\n        if (leftHeight < pageHeight) {\n          PDF.addImage(pageData, 'JPEG', 20, 20, imgWidth, imgHeight);\n        } else {\n          while (leftHeight > 0) {\n            PDF.addImage(pageData, 'JPEG', 20, position, imgWidth, imgHeight);\n            leftHeight -= pageHeight;\n            position -= 841.89;\n            if (leftHeight > 0) {\n              PDF.addPage();\n            }\n          }\n        }\n        PDF.save('课题审核表.pdf'); //下载标题\n      });\n    },\n\n    //获取导师信息\n    async getTutorMsg() {\n      const resp = await this.$http.get(\"/userTutor/getStudentList/\" + jwt_prase().id);\n      if (resp.data.code === 200 & resp.data.data !== null) {\n        console.log(resp.data.data);\n        //this.title=resp.data.data.dictT\n      }\n    },\n\n    //获取topicList\n    async getTopicList() {\n      const resp = await this.$http.get(\"/topic/\" + jwt_prase().id);\n      if (resp.data.code === 200 & resp.data.data !== null) {\n        console.log(resp.data.data);\n        this.topicList = resp.data.data;\n      }\n    },\n    //获取student的数量\n    async getStudentNum() {\n      const resp = await this.$http.get(\"/userTutor/getStudentList/\" + jwt_prase().id);\n      if (resp.data.code === 200 & resp.data.data !== null) {\n        this.stuNum = resp.data.data.length;\n      }\n    }\n  },\n  created() {\n    //根据导师用户id 获取 导师姓名、职称、课题数量（已被选择的课题）\n    this.getTutorMsg();\n    this.getTopicList();\n    this.getStudentNum();\n\n    //根据导师id获取该导师的所有课题（课题名称、命题性质、来源、审核结果）\n\n    //遍历topicList，统计出passedResult（unPassed,basePassed, passed）\n    const _this = this;\n    this.topicList.forEach(item => {\n      if (item.passed === 2) {\n        _this.passedResult.passed++;\n      } else if (item.passed === 1) {\n        _this.passedResult.basePassed++;\n      } else if (item.passed === 0) {\n        _this.passedResult.unPassed++;\n      }\n    });\n    //遍历topicList,合并修改建议\n    this.topicList.forEach((item, index) => {\n      _this.suggestions += \"课题\" + (index + 1) + \":\" + item.suggestion + \"<br>\";\n    });\n  }\n};","map":{"version":3,"mappings":"AAoDA;AACA;AACA;AAEA;EACAA;EACAC;IACA;MAEAC;MACAC;MACAC;MAEAC;MACAC;QACAC;QACAC;QACAC;MACA;MACAC;IAEA;EACA;EACAC;IACA;IACAC;MACA;MACAC;QACAC;QAAA;QACAC;QACAC;QAAA;QACAC;MACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;UACAC;QACA;UACA;YACAA;YACAC;YACAC;YACA;cACAF;YACA;UACA;QACA;QACAA;MACA;IACA;;IAEA;IACA;MACA;MACA;QACAG;QACA;MACA;IACA;;IACA;IACA;MACA;MACA;QACAA;QACA;MACA;IACA;IACA;IACA;MACA;MACA;QACA;MACA;IACA;EACA;EACAC;IACA;IACA;IACA;IACA;;IAEA;;IAIA;IACA;IACA;MACA;QACAC;MACA;QACAA;MACA;QACAA;MACA;IACA;IACA;IACA;MACAA,qBACA,QACAC,aACA,MACAC,kBACA;IACA;EAEA;AAGA","names":["name","data","tName","title","stuNum","topicList","passedResult","unPassed","basePassed","passed","suggestions","methods","pdfDownload","html2canvas","useCORS","allowTaint","dpi","scale","PDF","leftHeight","position","console","created","_this","index","item"],"sourceRoot":"src/components/home/shared","sources":["Detail.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <table class=\"dia\" align=\"center\" width=\"900px\" border=\"2px\" cellspacing=\"0\" cellpadding=\"10\" ref=\"checkTable\">\r\n            <caption>\r\n                <h1>毕业设计选题审核表</h1>\r\n            </caption>\r\n            <tr>\r\n                <td width=\"150px\">指导老师姓名</td>\r\n                <td width=\"100px\">{{ tutor.tName }}</td>\r\n                <td width=\"70px\">职称</td>\r\n                <td width=\"370px\">{{ tutor.title }}</td>\r\n                <td width=\"150px\">指导学生数量</td>\r\n                <td width=\"120px\">{{ tutor.stuNum }}</td>\r\n            </tr>\r\n            <tr>\r\n                <td></td>\r\n                <td colspan=\"2\">课题名称</td>\r\n                <td>命题性质</td>\r\n                <td>来源</td>\r\n                <td>是否合适</td>\r\n            </tr>\r\n            <template>\r\n                <tr v-for=\"item, index in topicList\">\r\n                    <td width=\"40px\">{{ index + 1 }}</td>\r\n                    <td colspan=\"2\" width=\"500px\" align=\"left\">{{ item.topicName }}</td>\r\n                    <td width=\"120px\">{{ item.type }}</td>\r\n                    <td width=\"120px\">{{ item.source }}</td>\r\n                    <td width=\"120px\">{{ item.passed }}</td>\r\n                </tr>\r\n            </template>\r\n            <tr>\r\n                <td width=\"120px\" rowspan=\"3\" height=\"170px\">存在问题及其需要整改的建议</td>\r\n                <td rowspan=\"3\" colspan=\"3\" width=\"540px\" align=\"left\" v-html=\"suggestions\" class=\"suggestions_td\">\r\n\r\n                </td>\r\n                <td width=\"120px\">不合格课题数</td>\r\n                <td width=\"120px\">{{ passedResult.unPassed }}</td>\r\n            </tr>\r\n            <tr>\r\n                <td width=\"120px\">基本合格数</td>\r\n                <td width=\"120px\">{{ passedResult.basePassed }}</td>\r\n            </tr>\r\n            <tr>\r\n                <td width=\"120px\">合格课题数</td>\r\n                <td width=\"120px\">{{ passedResult.passed }}</td>\r\n            </tr>\r\n        </table>\r\n\r\n        <el-button plain type=\"primary\" @click=\"pdfDownload\">导出审核表</el-button>\r\n    </div>\r\n</template>\r\n<script>\r\nimport jwt_prase from '@/assets/js/jwtPrase';\r\nimport html2canvas from 'html2canvas'\r\nimport JsPDF from 'jspdf'\r\n\r\nexport default {\r\n    name: \"Detail\",\r\n    data() {\r\n        return {\r\n\r\n            tName: '',\r\n            title: '',\r\n            stuNum: '',\r\n\r\n            topicList: [],\r\n            passedResult: {\r\n                unPassed: 0,\r\n                basePassed: 0,\r\n                passed: 0\r\n            },\r\n            suggestions: ''\r\n\r\n        }\r\n    },\r\n    methods: {\r\n        //导出审核表\r\n        pdfDownload() {\r\n            let myBox = this.$refs.checkTable; //获取ref里面的内容\r\n            html2canvas(myBox, {\r\n                useCORS: true, //是否尝试使用CORS从服务器加载图像\r\n                allowTaint: true,\r\n                dpi: 300, //解决生产图片模糊\r\n                scale: 3, //清晰度--放大倍数\r\n            }).then(function (canvas) {\r\n                let contentWidth = canvas.width\r\n                let contentHeight = canvas.height\r\n                let pageHeight = contentWidth / 592.28 * 841.89 // 一页pdf显示html页面生成的canvas高度;\r\n                let leftHeight = contentHeight //未生成pdf的html页面高度\r\n                let position = 0 //pdf页面偏移\r\n                //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高\r\n                // let imgWidth = 595.28\r\n                let imgWidth = 560.28  //宽度\r\n                let imgHeight = 592.28 / contentWidth * contentHeight\r\n                let pageData = canvas.toDataURL('image/jpeg', 1.0)\r\n                let PDF = new JsPDF('', 'pt', 'a4')\r\n\r\n                // 有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)\r\n                //当内容未超过pdf一页显示的范围，无需分页\r\n                if (leftHeight < pageHeight) {\r\n                    PDF.addImage(pageData, 'JPEG', 20, 20, imgWidth, imgHeight)\r\n                } else {\r\n                    while (leftHeight > 0) {\r\n                        PDF.addImage(pageData, 'JPEG', 20, position, imgWidth, imgHeight)\r\n                        leftHeight -= pageHeight\r\n                        position -= 841.89\r\n                        if (leftHeight > 0) {\r\n                            PDF.addPage()\r\n                        }\r\n                    }\r\n                }\r\n                PDF.save('课题审核表.pdf')//下载标题\r\n            });\r\n        },\r\n\r\n        //获取导师信息\r\n        async getTutorMsg() {\r\n            const resp = await this.$http.get(\"/userTutor/getStudentList/\" + jwt_prase().id)\r\n            if (resp.data.code === 200 & resp.data.data !== null) {\r\n                console.log(resp.data.data);\r\n                //this.title=resp.data.data.dictT\r\n            }\r\n        },\r\n        //获取topicList\r\n        async getTopicList() {\r\n            const resp = await this.$http.get(\"/topic/\" + jwt_prase().id)\r\n            if (resp.data.code === 200 & resp.data.data !== null) {\r\n                console.log(resp.data.data);\r\n                this.topicList = resp.data.data\r\n            }\r\n        },\r\n        //获取student的数量\r\n        async getStudentNum() {\r\n            const resp = await this.$http.get(\"/userTutor/getStudentList/\" + jwt_prase().id)\r\n            if (resp.data.code === 200 & resp.data.data !== null) {\r\n                this.stuNum = resp.data.data.length\r\n            }\r\n        }\r\n    },\r\n    created() {\r\n        //根据导师用户id 获取 导师姓名、职称、课题数量（已被选择的课题）\r\n        this.getTutorMsg()\r\n        this.getTopicList()\r\n        this.getStudentNum()\r\n\r\n        //根据导师id获取该导师的所有课题（课题名称、命题性质、来源、审核结果）\r\n        \r\n\r\n\r\n        //遍历topicList，统计出passedResult（unPassed,basePassed, passed）\r\n        const _this = this\r\n        this.topicList.forEach((item) => {\r\n            if (item.passed === 2) {\r\n                _this.passedResult.passed++\r\n            } else if (item.passed === 1) {\r\n                _this.passedResult.basePassed++\r\n            } else if (item.passed === 0) {\r\n                _this.passedResult.unPassed++\r\n            }\r\n        })\r\n        //遍历topicList,合并修改建议\r\n        this.topicList.forEach((item, index) => {\r\n            _this.suggestions +=\r\n                \"课题\"\r\n                + (index + 1)\r\n                + \":\"\r\n                + item.suggestion\r\n                + \"<br>\"\r\n        })\r\n\r\n    }\r\n\r\n\r\n}\r\n</script>\r\n<style scoped lang=\"less\">\r\n.CheckTable {\r\n    border: 2px solid;\r\n}\r\n\r\ntable {\r\n    border-collapse: collapse;\r\n    margin: 0 auto;\r\n}\r\n\r\n.dia {\r\n    line-height: 23px;\r\n    font-size: 18px;\r\n}\r\n\r\n.dia td {\r\n    font-size: 15px;\r\n    text-align: center;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}