{"ast":null,"code":"import html2canvas from 'html2canvas';\nimport JsPDF from 'jspdf';\nimport request from '@/utils/request';\nexport default {\n  data() {\n    return {\n      visible: false,\n      checkTable: {},\n      teacher: {\n        name: \"\"\n      },\n      unpass: 0,\n      basepass: 0,\n      pass: 0,\n      comeFrom: [\"自命题\", \"企业\", \"教师科研\"],\n      sui: [\"不合格\", \"基本合格\", \"合格\"]\n    };\n  },\n  methods: {\n    setInfo() {\n      request.get(\"/api/info/teacher/\" + this.checkTable.teacherId).then(res => {\n        this.teacher = res.data;\n      });\n      this.unpass = 0;\n      this.basepass = 0;\n      this.pass = 0;\n      this.checkTable.topics.forEach((topic, i) => {\n        switch (topic.sui) {\n          case 0:\n            this.unpass++;\n            break;\n          case 1:\n            this.basepass++;\n            break;\n          case 2:\n            this.pass++;\n            break;\n        }\n      });\n    },\n    // 下载pdf\n    pdfDownload() {\n      let myBox = this.$refs.checkTable; //获取ref里面的内容\n      let that = this;\n      html2canvas(myBox, {\n        useCORS: true,\n        //是否尝试使用CORS从服务器加载图像\n        allowTaint: true,\n        dpi: 300,\n        //解决生产图片模糊\n        scale: 3 //清晰度--放大倍数\n      }).then(function (canvas) {\n        let contentWidth = canvas.width;\n        let contentHeight = canvas.height;\n        let pageHeight = contentWidth / 592.28 * 841.89; // 一页pdf显示html页面生成的canvas高度;\n        let leftHeight = contentHeight; //未生成pdf的html页面高度\n        let position = 0; //pdf页面偏移\n        //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高\n        // let imgWidth = 595.28\n        let imgWidth = 560.28; //宽度\n        let imgHeight = 592.28 / contentWidth * contentHeight;\n        let pageData = canvas.toDataURL('image/jpeg', 1.0);\n        let PDF = new JsPDF('', 'pt', 'a4');\n\n        // 有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)\n        //当内容未超过pdf一页显示的范围，无需分页\n        if (leftHeight < pageHeight) {\n          PDF.addImage(pageData, 'JPEG', 20, 20, imgWidth, imgHeight);\n        } else {\n          while (leftHeight > 0) {\n            PDF.addImage(pageData, 'JPEG', 20, position, imgWidth, imgHeight);\n            leftHeight -= pageHeight;\n            position -= 841.89;\n            if (leftHeight > 0) {\n              PDF.addPage();\n            }\n          }\n        }\n        PDF.save('课题审核表.pdf'); //下载标题\n        that.visible = false;\n      });\n    }\n  }\n};","map":{"version":3,"mappings":"AAkDA;AACA;AACA;AAEA;EACAA;IACA;MACAC;MACAC;MACAC;QAAAC;MAAA;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACAC;MACAC;QACA;MACA;MACA;MACA;MACA;MACA;QACA;UACA;YACA;YACA;UACA;YACA;YACA;UACA;YACA;YACA;QAAA;MAEA;IACA;IACA;IACAC;MACA;MACA;MACAC;QACAC;QAAA;QACAC;QACAC;QAAA;QACAC;MACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;UACAC;QACA;UACA;YACAA;YACAC;YACAC;YACA;cACAF;YACA;UACA;QACA;QACAA;QACAG;MACA;IACA;EACA;AACA","names":["data","visible","checkTable","teacher","name","unpass","basepass","pass","comeFrom","sui","methods","setInfo","request","pdfDownload","html2canvas","useCORS","allowTaint","dpi","scale","PDF","leftHeight","position","that"],"sourceRoot":"src/components/home/shared","sources":["Detail.vue"],"sourcesContent":["<template>\r\n    <el-dialog title=\"审核表详情页\" v-model=\"visible\" width=\"1000px\" center>\r\n        <table class=\"dia\" align=\"center\" width=\"900px\" border=\"2px\" cellspacing=\"0\" cellpadding=\"10\" ref=\"checkTable\">\r\n            <caption>\r\n                <h1>毕业设计选题审核表</h1>\r\n            </caption>\r\n            <tr>\r\n                <td width=\"150px\">指导老师姓名</td>\r\n                <td width=\"100px\">{{ teacher.name }}</td>\r\n                <td width=\"70px\">职称</td>\r\n                <td width=\"370px\">{{ teacher.title }}</td>\r\n                <td width=\"150px\">指导学生数量</td>\r\n                <td width=\"120px\">{{ checkTable.topics.length }}</td>\r\n            </tr>\r\n            <tr>\r\n                <td></td>\r\n                <td colspan=\"2\">课题名称</td>\r\n                <td>命题性质</td>\r\n                <td>来源</td>\r\n                <td>是否合适</td>\r\n            </tr>\r\n            <template v-for=\"(topic, i) in checkTable.topics\" :key=\"topic.id\">\r\n                <tr>\r\n\r\n                    <td width=\"40px\">{{ i + 1 }}</td>\r\n                    <td colspan=\"2\" width=\"500px\" align=\"left\">{{ topic.name }}</td>\r\n                    <td width=\"120px\">{{ topic.type ? \"设计\" : \"论文\" }}</td>\r\n                    <td width=\"120px\">{{ comeFrom[topic.comeFrom] }}</td>\r\n                    <td width=\"120px\">{{ sui[topic.sui] }}</td>\r\n\r\n                </tr>\r\n            </template>\r\n            <tr>\r\n                <td width=\"120px\" rowspan=\"3\" height=\"170px\">存在问题及其需要整改的建议</td>\r\n                <td rowspan=\"3\" colspan=\"3\" width=\"540px\" align=\"left\">{{ checkTable.suggest }}</td>\r\n                <td width=\"120px\">不合格课题数</td>\r\n                <td width=\"120px\">{{ unpass }}</td>\r\n            </tr>\r\n            <tr>\r\n                <td width=\"120px\">基本合格数</td>\r\n                <td width=\"120px\">{{ basepass }}</td>\r\n            </tr>\r\n            <tr>\r\n                <td width=\"120px\">合格课题数</td>\r\n                <td width=\"120px\">{{ pass }}</td>\r\n            </tr>\r\n        </table>\r\n    </el-dialog>\r\n</template>\r\n<script>\r\nimport html2canvas from 'html2canvas'\r\nimport JsPDF from 'jspdf'\r\nimport request from '@/utils/request'\r\n\r\nexport default {\r\n    data() {\r\n        return {\r\n            visible: false,\r\n            checkTable: {},\r\n            teacher: { name: \"\" },\r\n            unpass: 0,\r\n            basepass: 0,\r\n            pass: 0,\r\n            comeFrom: [\"自命题\", \"企业\", \"教师科研\"],\r\n            sui: [\"不合格\", \"基本合格\", \"合格\"],\r\n        }\r\n    },\r\n    methods: {\r\n        setInfo() {\r\n            request.get(\"/api/info/teacher/\" + this.checkTable.teacherId).then(res => {\r\n                this.teacher = res.data\r\n            })\r\n            this.unpass = 0\r\n            this.basepass = 0\r\n            this.pass = 0\r\n            this.checkTable.topics.forEach((topic, i) => {\r\n                switch (topic.sui) {\r\n                    case 0:\r\n                        this.unpass++\r\n                        break\r\n                    case 1:\r\n                        this.basepass++\r\n                        break\r\n                    case 2:\r\n                        this.pass++\r\n                        break\r\n                }\r\n            })\r\n        },\r\n        // 下载pdf\r\n        pdfDownload() {\r\n            let myBox = this.$refs.checkTable; //获取ref里面的内容\r\n            let that = this\r\n            html2canvas(myBox, {\r\n                useCORS: true, //是否尝试使用CORS从服务器加载图像\r\n                allowTaint: true,\r\n                dpi: 300, //解决生产图片模糊\r\n                scale: 3, //清晰度--放大倍数\r\n            }).then(function (canvas) {\r\n                let contentWidth = canvas.width\r\n                let contentHeight = canvas.height\r\n                let pageHeight = contentWidth / 592.28 * 841.89 // 一页pdf显示html页面生成的canvas高度;\r\n                let leftHeight = contentHeight //未生成pdf的html页面高度\r\n                let position = 0 //pdf页面偏移\r\n                //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高\r\n                // let imgWidth = 595.28\r\n                let imgWidth = 560.28  //宽度\r\n                let imgHeight = 592.28 / contentWidth * contentHeight\r\n                let pageData = canvas.toDataURL('image/jpeg', 1.0)\r\n                let PDF = new JsPDF('', 'pt', 'a4')\r\n\r\n                // 有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)\r\n                //当内容未超过pdf一页显示的范围，无需分页\r\n                if (leftHeight < pageHeight) {\r\n                    PDF.addImage(pageData, 'JPEG', 20, 20, imgWidth, imgHeight)\r\n                } else {\r\n                    while (leftHeight > 0) {\r\n                        PDF.addImage(pageData, 'JPEG', 20, position, imgWidth, imgHeight)\r\n                        leftHeight -= pageHeight\r\n                        position -= 841.89\r\n                        if (leftHeight > 0) {\r\n                            PDF.addPage()\r\n                        }\r\n                    }\r\n                }\r\n                PDF.save('课题审核表.pdf')//下载标题\r\n                that.visible = false\r\n            });\r\n        },\r\n    },\r\n}\r\n</script>\r\n<style>\r\n.CheckTable {\r\n    border: 2px solid;\r\n}\r\n\r\ntable {\r\n    border-collapse: collapse;\r\n    margin: 0 auto;\r\n}\r\n\r\n.dia td {\r\n    font-size: 15px;\r\n    text-align: center;\r\n}\r\n</style>\r\n  "]},"metadata":{},"sourceType":"module","externalDependencies":[]}